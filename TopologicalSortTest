package graph.topo;

import graph.TestUtils;
import graph.metrics.Metrics;
import org.junit.Test;
import static org.junit.Assert.*;

import java.util.*;

public class TopologicalSortTest {

    @Test
    public void testSimpleDAG() {
        List<List<Integer>> graph = new ArrayList<>();
        graph.add(Arrays.asList(1, 3));
        graph.add(Arrays.asList(2));
        graph.add(new ArrayList<>());
        graph.add(Arrays.asList(4));
        graph.add(new ArrayList<>());

        Metrics metrics = new TestUtils.TestMetrics();
        TopologicalSort topoSort = new KahnTopologicalSort(graph, metrics);
        List<Integer> result = topoSort.sort();

        assertEquals(5, result.size());
        assertTrue(TestUtils.isTopologicalOrder(graph, result));
    }

    @Test
    public void testLinearDAG() {
        List<List<Integer>> graph = new ArrayList<>();
        graph.add(Arrays.asList(1));
        graph.add(Arrays.asList(2));
        graph.add(Arrays.asList(3));
        graph.add(new ArrayList<>());

        Metrics metrics = new TestUtils.TestMetrics();
        TopologicalSort topoSort = new KahnTopologicalSort(graph, metrics);
        List<Integer> result = topoSort.sort();

        assertEquals(4, result.size());
        assertTrue(TestUtils.isTopologicalOrder(graph, result));
    }

    @Test
    public void testSingleNode() {
        List<List<Integer>> graph = new ArrayList<>();
        graph.add(new ArrayList<>());

        Metrics metrics = new TestUtils.TestMetrics();
        TopologicalSort topoSort = new KahnTopologicalSort(graph, metrics);
        List<Integer> result = topoSort.sort();

        assertEquals(1, result.size());
        assertEquals(0, (int) result.get(0));
    }
}
